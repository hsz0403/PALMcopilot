[{"history": {"proof": "intros net net' e t H. hauto lq: on.", "repairs": ["", "hammer"], "exceptions": [{"ctx": ["intros net net' e t H."], "tactic": "rewrite <- H.", "exn": "Found no subterm matching \"nwState net ?M13675\" in the current goal.", "type": "no_subterm", "handled": true}]}, "chat": [{"role": "user", "content": "I will give you a Coq proof state, including both hypotheses and a specific goal and your need to prove it. Your response should be a singular code block of Coq proof starting with \"```coq\n\", ending with \"Qed.```\", without any additional explanation or commentary. Follow to these guidelines:\nIntroduce variables using unique names to avoid any conflicts.\nKeep each command distinct and separated, avoid concatenations like ';' or '[cmd|cmd]'.\nOrganize your proof with bullets like '-', '+', and '*' instead of braces ({, }). Shift to their double symbols like '--' and '++', when necessary.\nEffectively use given premises, follow the syntax and structure demonstrated in the examples provided.\n\nExample 1:\n\nHypotheses:\nn, m: nat\nIHn: m + n = n + m\n\nGoal:\nm + S n = S n + m\n\nProof:\n```coq\nsimpl. rewrite <- IHn. auto.\nQed.```\n\nExample 2:\nHypotheses:\n\nGoal:\nforall n m : nat, m + n = n + m\n\n```coq\nintros n m. induction n.\n- simpl. auto.\n- simpl. rewrite <- IHn. auto.\nQed.```\n\nSolve This Proof State:\n\nHypotheses:\norig_base_params: BaseParams\none_node_params: OneNodeParams orig_base_params\nraft_params: RaftParams orig_base_params\nrri: raft_refinement_interface\nsi: sorted_interface\nlmi: log_matching_interface\nsmspi: state_machine_safety'interface\nrlmli: refined_log_matching_lemmas_interface\npllsi: prevLog_leader_sublog_interface\nctgt0: current_term_gt_zero_interface\nlalcii: lastApplied_le_commitIndex_interface\nmiaei: match_index_all_entries_interface\nlhlli: leaders_have_leaderLogs_interface\nlci: leader_completeness_interface\nlsi: leader_sublog_interface\ntaifoli: terms_and_indices_from_one_log_interface\nglci: ghost_log_correct_interface\nlphogli: log_properties_hold_on_ghost_logs_interface\nglemi: ghost_log_entries_match_interface\ntci: transitive_commit_interface\ntsi: term_sanity_interface\nlhllsi: leaders_have_leaderLogs_strong_interface\nollpti: one_leaderLog_per_term_interface\nrmri: raft_msg_refinement_interface\n\nGoal:\nforall (net net' : ghost_log_network) (e : entry) (t : term), (forall h : Net.name, nwState net' h = nwState net h) -> lifted_committed net e t -> lifted_committed net' e t\n\nPremises:\nlifted_committed = fun (net : ghost_log_network) (e : entry) (t : term) => exists (h : Net.name) (e' : entry), eTerm e' <= t /\\ lifted_directly_committed net e' /\\ eIndex e <= eIndex e' /\\ In e (log (snd (nwState net h))) /\\ In e' (log (snd (nwState net h))) : ghost_log_network -> entry -> term -> Prop\nghost_log_network = network : Type\nname = fun (orig_base_params : BaseParams) (raft_params : RaftParams orig_base_params) => fin N : forall orig_base_params : BaseParams, RaftParams orig_base_params -> Type Arguments name {orig_base_params raft_params}\nnwState = fun (P : BaseParams) (params : MultiParams P) (n : network) => let (_, nwState) := n in nwState : forall (P : BaseParams) (params : MultiParams P), network -> Net.name -> data Arguments nwState {P params}\nterm = nat : Set\nRecord RaftParams (orig_base_params : BaseParams) : Type := Build_RaftParams { N : nat; input_eq_dec : forall x y : input, {x = y} + {x <> y}; output_eq_dec : forall x y : output, {x = y} + {x <> y}; clientId : Type; clientId_eq_dec : forall x y : clientId, {x = y} + {x <> y} } Arguments Build_RaftParams _ _%nat_scope (_ _)%function_scope [clientId]%type_scope _%function_scope\n*** [ Core.ByteListReader.t : Type -> Type ] Arguments Core.ByteListReader.t _%type_scope\nRecord entry (orig_base_params : BaseParams) (raft_params : RaftParams orig_base_params) : Type := mkEntry { eAt : name; eClient : clientId; eId : nat; eIndex : logIndex; eTerm : term; eInput : input } Arguments entry {orig_base_params raft_params} Arguments mkEntry {orig_base_params raft_params} _ _ _%nat_scope\nModule Net := Struct Record BaseParams : Type := Build_BaseParams { data : Type; input : Type; output : Type } Definition data : BaseParams -> Type. Definition input : BaseParams -> Type. Definition output : BaseParams -> Type. Record OneNodeParams (P : BaseParams) : Type := Build_OneNodeParams { init : data; handler : input -> data -> output * data } Definition init : forall P : BaseParams, OneNodeParams P -> data. Definition handler : forall P : BaseParams, OneNodeParams P -> input -> data -> output * data. Record SingleParams (P : BaseParams) : Type := Build_SingleParams { init_handler : data; input_handler : input -> data -> list output * data } Definition init_handler : forall P : BaseParams,\nRecord OneNodeParams (P : BaseParams) : Type := Build_OneNodeParams { init : data; handler : input -> data -> output * data } Arguments Build_OneNodeParams _ _ _%function_scope\nreboot_preserves_committed : forall (net net' : ghost_log_network) (h : name) (e : entry) (t : term), (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (fst (nwState net h), reboot (snd (nwState net h))) h') -> lifted_committed net e t -> lifted_committed net' e t\ndoLeader_preserves_committed : forall (net net' : ghost_log_network) (d : raft_data) (h : name) (os : list raft_output) (d' : raft_data) (ms : list (name * msg)) (gd : ghost_data) (e : entry) (t : term), doLeader d h = (os, d', ms) -> nwState net h = (gd, d) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (gd, d') h') -> lifted_committed net e t -> lifted_committed net' e t\nhandleTimeout_preserves_committed : forall (h : name) (net net' : ghost_log_network) (out : list raft_output) (d' : raft_data) (l : list (name * msg)) (e : entry) (t : term), handleTimeout h (snd (nwState net h)) = (out, d', l) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (update_elections_data_timeout h (nwState net h), d') h') -> lifted_committed net e t -> lifted_committed net' e t\ndoGenericServer_preserves_committed : forall (net net' : ghost_log_network) (h : name) (out : list raft_output) (st' : raft_data) (ms : list (name * msg)) (e : entry) (t : term), doGenericServer h (snd (nwState net h)) = (out, st', ms) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (fst (nwState net h), st') h') -> lifted_committed net e t -> lifted_committed net' e t\nhandleRequestVoteReply_preserves_committed : forall (net net' : ghost_log_network) (h src : name) (t : nat) (v : bool) (st' : raft_data) (e : entry) (t' : term), handleRequestVoteReply h (snd (nwState net h)) src t v = st' -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (update_elections_data_requestVoteReply h src t v (nwState net h), st') h') -> lifted_committed net e t' -> lifted_committed net' e t'\nhCR_preserves_committed : forall (net net' : ghost_log_network) (h : name) (client : clientId) (id : nat) (c : input) (out : list raft_output) (d : raft_data) (l : list (name * msg)) (e : entry) (t : term), handleClientRequest h (snd (nwState net h)) client id c = (out, d, l) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (update_elections_data_client_request h (nwState net h) client id c, d) h') -> lifted_committed net e t -> lifted_committed net' e t\nhandleAppendEntriesReply_preserves_commit : forall (net net' : ghost_log_network) (h src : name) (t : nat) (es : list entry) (b : bool) (st' : raft_data) (l : list (name * msg)) (e : entry) (t' : term), handleAppendEntriesReply h (snd (nwState net h)) src t es b = (st', l) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (fst (nwState net h), st') h') -> lifted_committed net e t' -> lifted_committed net' e t'\nhandleRequestVote_preserves_committed : forall (net net' : ghost_log_network) (h : name) (t : nat) (c : fin N) (li lt : nat) (st' : raft_data) (ms : msg) (e : entry) (t' : term), handleRequestVote h (snd (nwState net h)) t c li lt = (st', ms) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (update_elections_data_requestVote h c t c li lt (nwState net h), st') h') -> lifted_committed net e t' -> lifted_committed net' e t'\nlifted_committed_log_allEntries_preserved : forall (net : ghost_log_network) (net' : network) (e : entry) (t : term), lifted_committed net e t -> (forall (h : Net.name) (e' : entry), In e' (log (snd (nwState net h))) -> In e' (log (snd (nwState net' h)))) -> (forall (h : Net.name) (e' : entry) (t' : term), In (t', e') (allEntries (fst (nwState net h))) -> In (t', e') (allEntries (fst (nwState net' h)))) -> lifted_committed net' e t\nhandleAppendEntries_preserves_commit : forall (net net' : network) (h : name) (p : packet) (t : term) (n : name) (pli : logIndex) (plt : term) (es : list entry) (ci : logIndex) (d : raft_data) (m : msg) (e : entry) (t' : term), msg_refined_raft_intermediate_reachable net -> In p (nwPackets net) -> snd (pBody p) = AppendEntries t n pli plt es ci -> handleAppendEntries h (snd (nwState net h)) t n pli plt es ci = (d, m) ->...-> lifted_committed net' e t'\nlifted_committed_committed : forall (net : ghost_log_network) (e : entry) (t : term), lifted_committed net e t -> committed (mgv_deghost net) e t\nlifted_committed_ext : forall (ps : list packet) (st st' : Net.name -> data) (t : term) (e : entry), (forall h : Net.name, st' h = st h) -> lifted_committed {| nwPackets := ps; nwState := st |} e t -> lifted_committed {| nwPackets := ps; nwState := st' |} e t\nlifted_committed_ext' : forall (ps ps' : list packet) (st st' : Net.name -> data) (t : term) (e : entry), (forall h : Net.name, st' h = st h) -> lifted_committed {| nwPackets := ps; nwState := st |} e t -> lifted_committed {| nwPackets := ps'; nwState := st' |} e t\ncommitted_log_allEntries_preserved : forall (net net' : network) (e : entry) (t : term), committed net e t -> (forall (h : Net.name) (e' : entry), In e' (log (snd (nwState net h))) -> In e' (log (snd (nwState net' h)))) -> (forall (h : Net.name) (e' : entry) (t' : term), In (t', e') (allEntries (fst (nwState net h))) -> In (t', e') (allEntries (fst (nwState net' h)))) -> committed net' e t\ncommitted_lifted_committed : forall (net : network) (e : entry) (t : term), committed (mgv_deghost net) e t -> lifted_committed net e t\nrefined_raft_net_invariant_state_same_packet_subset = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall net net' : network, (forall h : Net.name, nwState net h = nwState net' h) -> (forall p : packet, In p (nwPackets net') -> In p (nwPackets net)) -> P net -> refined_raft_intermediate_reachable net -> P net' : forall (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params), (network -> Prop) -> Prop Arguments refined_raft_net_invariant_state_same_packet_subset {orig_base_params one_node_params raft_params} _%function_scope\nmsg_refined_raft_net_invariant_state_same_packet_subset' = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall net net' : network, (forall h : Net.name, nwState net h = nwState net' h) -> (forall p : packet, In p (nwPackets net') -> In p (nwPackets net)) -> P net -> msg_refined_raft_intermediate_reachable net -> P net' : forall (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params), (network -> Prop) -> Prop Arguments msg_refined_raft_net_invariant_state_same_packet_subset' {orig_base_params one_node_params raft_params} _%function_scope\nmsg_refined_raft_net_invariant_state_same_packet_subset = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall net net' : network, (forall h : Net.name, nwState net h = nwState net' h) -> (forall p : packet, In p (nwPackets net') -> In p (nwPackets net)) -> P net -> msg_refined_raft_intermediate_reachable net -> P net' : forall (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params), (network -> Prop) -> Prop Arguments msg_refined_raft_net_invariant_state_same_packet_subset {orig_base_params one_node_params raft_params} _%function_scope\ncommitted_ext : forall (ps : list packet) (st st' : Net.name -> data) (t : term) (e : entry), (forall h : Net.name, st' h = st h) -> committed {| nwPackets := ps; nwState := st |} e t -> committed {| nwPackets := ps; nwState := st' |} e t\ncommitted_ext' : forall (ps ps' : list packet) (st st' : Net.name -> data) (t : term) (e : entry), (forall h : Net.name, st' h = st h) -> committed {| nwPackets := ps; nwState := st |} e t -> committed {| nwPackets := ps'; nwState := st' |} e t\nmsg_refined_raft_net_invariant_reboot' = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall (net net' : network) (gd : ghost_data) (d : RaftState.raft_data term name entry logIndex serverType data clientId output) (h : Net.name) (d' : raft_data), reboot d = d' -> P net -> msg_refined_raft_intermediate_reachable net -> msg_refined_raft_intermediate_reachable net' -> nwState net h = (gd, d) ->...-> Prop Arguments msg_refined_raft_net_invariant_reboot' {orig_base_params one_node_params raft_params} _%function_scope\nrefined_raft_net_invariant_reboot' = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall (net net' : network) (gd : ghost_data) (d : RaftState.raft_data term name entry logIndex serverType data clientId output) (h : Net.name) (d' : raft_data), reboot d = d' -> P net -> refined_raft_intermediate_reachable net -> refined_raft_intermediate_reachable net' -> nwState net h = (gd, d) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (gd, d') h') ->...-> Prop Arguments refined_raft_net_invariant_reboot' {orig_base_params one_node_params raft_params} _%function_scope\nmsg_refined_raft_net_invariant_reboot = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall (net net' : network) (gd : ghost_data) (d : RaftState.raft_data term name entry logIndex serverType data clientId output) (h : Net.name) (d' : raft_data), reboot d = d' -> P net -> msg_refined_raft_intermediate_reachable net -> nwState net h = (gd, d) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (gd, d') h') ->...-> Prop Arguments msg_refined_raft_net_invariant_reboot {orig_base_params one_node_params raft_params} _%function_scope\nrefined_raft_net_invariant_reboot = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall (net net' : network) (gd : ghost_data) (d : RaftState.raft_data term name entry logIndex serverType data clientId output) (h : Net.name) (d' : raft_data), reboot d = d' -> P net -> refined_raft_intermediate_reachable net -> nwState net h = (gd, d) -> (forall h' : Net.name, nwState net' h' = update name_eq_dec (nwState net) h (gd, d') h') -> nwPackets net = nwPackets net' ->...-> Prop Arguments refined_raft_net_invariant_reboot {orig_base_params one_node_params raft_params} _%function_scope\ntransitive_commit = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (net : network) => forall (h : Net.name) (e e' : entry) (t : term), In e (log (snd (nwState net h))) -> In e' (log (snd (nwState net h))) -> eIndex e <= eIndex e' -> committed net e' t -> committed net e t : forall (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params), network -> Prop Arguments transitive_commit {orig_base_params one_node_params raft_params}\ncommit_invariant_host = fun net : ghost_log_network => forall (h : Net.name) (e : entry), In e (log (snd (nwState net h))) -> eIndex e <= commitIndex (snd (nwState net h)) -> lifted_committed net e (currentTerm (snd (nwState net h))) : ghost_log_network -> Prop\nmatch_index_all_entries = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (net : network) => forall (e : entry) (leader : Net.name) (h : name), type (snd (nwState net leader)) = Leader -> eIndex e <= assoc_default name_eq_dec (matchIndex (snd (nwState net leader))) h 0 -> In e (log (snd (nwState net leader))) -> eTerm e = currentTerm (snd (nwState net leader)) -> In (eTerm e, e) (allEntries (fst (nwState net h))) : forall (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params), network -> Prop Arguments match_index_all_entries {orig_base_params one_node_params raft_params}\ncommitted = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (net : network) (e : entry) (t : term) => exists (h : Net.name) (e' : entry), eTerm e' <= t /\\ directly_committed net e' /\\ eIndex e <= eIndex e' /\\ In e (log (snd (nwState net h))) /\\ In e' (log (snd (nwState net h))) : forall (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params), network -> entry -> term -> Prop Arguments committed {orig_base_params one_node_params raft_params}\nRecord sorted_interface (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) : Prop := Build_sorted_interface { handleAppendEntries_logs_sorted : forall (net : network) (p : packet) (t : term) (n : name) (pli : logIndex) (plt : term) (es : list entry) (ci : logIndex) (st' : raft_data) (m : msg), raft_intermediate_reachable net -> logs_sorted net -> handleAppendEntries (pDst p) (nwState net (pDst p)) t n pli plt es ci = (st', m) -> pBody p = AppendEntries t n pli plt es ci ->...-> logs_sorted net } Arguments sorted_interface {orig_base_params one_node_params raft_params} Arguments Build_sorted_interface {orig_base_params one_node_params raft_params} (_ _ _)%function_scope\nrefined_raft_net_invariant_request_vote_reply' = fun (orig_base_params : BaseParams) (one_node_params : OneNodeParams orig_base_params) (raft_params : RaftParams orig_base_params) (P : network -> Prop) => forall (xs : list packet) (p : packet) (ys : list packet) (net : network) (st' : Net.name -> data) (ps' : list packet) (gd : electionsData) (d : raft_data) (t : nat) (v : bool), handleRequestVoteReply (pDst p) (snd (nwState net (pDst p))) (pSrc p) t v = d ->...-> Prop Arguments refined_raft_net_invariant_request_vote_reply' {orig_base_params one_node_params raft_params} _%function_scope"}, {"role": "assistant", "content": "```coq\nintros net net' e t H.\nrewrite <- H.\napply lifted_committed_log_allEntries_preserved.\n- apply H.\n- intros h e' Hin.\n  apply H.\n  exact Hin.\n- intros h e' t' Hin.\n  apply H.\n  exact Hin.\nQed.\n```"}], "original": "intros net net' e t H. rewrite <- H. apply lifted_committed_log_allEntries_preserved. - apply H. - intros h e' Hin. apply H. apply Hin. - intros h e' t' Hin. apply H. apply Hin.", "succ": true}]